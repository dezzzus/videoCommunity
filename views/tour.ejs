<% include head.ejs %>
<script>
    _gaq.push(['_setCustomVar',
        1,
        'IsSuperuser',
        '<%= agent.superuser %>',
        3 // page level
    ]);
    _gaq.push(['_setCustomVar',
        2,
        'AgentId',
        '<%= agent._id %>',
        3 // page level
    ]);
    _gaq.push(['_trackEvent',
        'tour', // category of activity
        'pageview', // Action
    ]);
</script>
<div class="container">
    <br>

    <div>
        Agent: <%= agent.name %>
    </div>


    <h1>Add tour:</h1>

    <div class="row">
        <div class="col-md-4">
            <div class="formbox">
                <form action="/tour" method="post" id="tour_form" enctype="multipart/form-data">
                    <div class="form-group">
                        <label for="videofile_input">Video file:</label>
                        <input type="file" class="form-control" id="videofile_input" name="videoFile"/>
                    </div>
                    <div class="form-group">
                        <label for="address_input">Address:</label>
                        <input type="text" class="form-control" id="address_input" name="address"/>
                    </div>
                    
                    <% if (agent.superuser) { %>
                        <div class="form-group">
                            <label for="agent_select">Agent:</label>
                            <select class="form-control" id="agent_select" name="agent">
                                <% for (var i = 0; i < agents.length;i++) { %>
                                    <option value="<%= agents[i]._id %>"
                                    
                                    <% if (agent.name === agents[i].name) { %>
                                       selected="selected"
                                    <% } %>
                                    
                                    > <%= agents[i].name %> </option>
                                <% } %>
                            </select>
                        </div>
                    <% } else { %>
                       <input type="hidden" name="agent" value="<%= agent._id %>">
                    <% } %>
                    
                    <div class="form-group">
                        <div class="submit_tour btn btn-success">
                            <i class="fa fa-refresh fa-spin"></i>
                            Submit
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script type="application/javascript">
        $(function () {
            _gaq.push(['_trackEvent',
                'tour', // category of activity
                'submit_new', // Action
            ]);
            var submitBtn = $('.submit_tour');
            submitBtn.on('click', function () {
                submitBtn.find('i').show();
                $('#tour_form').submit();
            });
        });
    </script>


    <h1>All tours:</h1>

    <table class="table table-hover">
        <thead>
        <tr>
            <td>Tour id</td>
            <td>Player type</td>
            <td>Address</td>
        </tr>
        </thead>
        <tbody>
        <% for (var i = 0; i < tours.length;i++){ %>
        <tr>
            <td><a href="/tour/<%= tours[i]._id %>"><%= tours[i]._id %></a></td>
            <td><%= tours[i].playerType %></td>
            <td><%= tours[i].address %></td>
        </tr>
        <% } %>
        </tbody>
    </table>
</div>
<% include foot.ejs %>